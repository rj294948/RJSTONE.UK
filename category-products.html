<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan SandStone Hub - Products</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 0;
  }

  /* ‚úÖ FIXED HEADER & REDUCED TOP PADDING */
  h1 {
    text-align: center;
    background-color: #c45e00;
    color: white;
    padding: 10px; /* Reduced padding */
    margin: 0;
    font-size: 24px;
    position: fixed; /* Header remains fixed on top */
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  /* Main Layout: Filters (Sidebar) and Products (Grid) */
  #main-content {
    display: flex;
    padding-top: 60px; /* Space for fixed h1 header */
    min-height: calc(100vh - 60px);
  }

  /* Filter Panel Styles (Smart Filter Sidebar) */
  #filter-panel {
    width: 280px;
    padding: 20px 15px;
    background-color: #fff;
    box-shadow: 2px 0 5px rgba(0,0,0,0.05);
    flex-shrink: 0;
    /* Sticky filter panel for better scrolling */
    position: sticky;
    top: 60px; 
    height: calc(100vh - 60px); 
    overflow-y: auto;
  }
  
  #filter-panel h2 {
    color: #c45e00;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 10px;
    margin-top: 0;
  }
  
  .filter-group {
    margin-bottom: 20px;
  }
  
  .filter-group label {
    display: block;
    margin: 5px 0;
    cursor: pointer;
    font-size: 14px;
    color: #333;
  }

  /* Products Grid Styles */
  #products-container {
      flex-grow: 1;
  }

  #products {
    display: grid;
    /* ‚úÖ FIX: 4 products per row */
    grid-template-columns: repeat(4, 1fr); 
    gap: 20px;
    padding: 20px;
  }

  /* Product Card Styles */
  .product-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    overflow: hidden;
    text-align: left; /* Changed from center */
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.2);
  }

  .product-img {
    width: 100%;
    height: 250px; /* ‚úÖ FIX: Increased height for bigger images */
    object-fit: cover;
  }

  .product-info {
      padding: 10px 15px;
  }

  .product-card h3 {
    margin: 5px 0 0;
    color: #333;
    font-size: 18px;
    line-height: 1.2;
  }

  /* ‚úÖ PRICE/RATE STYLE */
  .price {
    color: #007bff; 
    font-weight: bold;
    margin: 5px 0;
    font-size: 16px;
  }
  
  /* ‚úÖ DESCRIPTION STYLE */
  .description-short {
    margin: 5px 0 10px;
    font-size: 14px;
    color: #555;
    min-height: 40px; 
  }
  
  .contact-info {
    font-size: 13px;
    color: #777;
    margin: 5px 0;
  }

  footer {
    text-align: center;
    padding: 15px;
    background-color: #333;
    color: white;
  }
</style>
</head>
<body>

<h1>ü™® Rajasthan SandStone Hub</h1>

<div id="main-content">
    
    <div id="filter-panel">
        <h2><i class="fas fa-filter"></i> Filters</h2>
        
        <button onclick="applyFilters()" style="padding: 10px; background-color: #c45e00; color: white; border: none; width: 100%; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">Apply Filters</button>
        
        <div class="filter-group">
            <h3>Stone Type (SUB CATAGORY)</h3>
            <div id="stone-type-filters">
                <p>Loading types...</p>
            </div>
        </div>

        <div class="filter-group">
            <h3>Category (CATAGORY)</h3>
            <div id="category-filters">
                <p>Loading categories...</p>
            </div>
        </div>

        <div class="filter-group">
            <h3>Color</h3>
            <div id="color-filters">
                <p>Loading colors...</p>
            </div>
        </div>
        
        <button onclick="clearFilters()" style="padding: 10px; background-color: #f4f4f4; color: #333; border: 1px solid #ddd; width: 100%; border-radius: 5px; cursor: pointer; margin-top: 10px;">Clear Filters</button>

    </div>

    <div id="products-container">
        <p id="product-count" style="padding: 10px 20px; color: #555;">Showing 0 products.</p>
        <div id="products">Loading products...</div>
    </div>
</div>


<footer>¬© 2025 Rajasthan SandStone Hub | All Rights Reserved</footer>

<script>
// === CONFIG ===
const SHEET_ID = "1ob32T2NWQVZnxC07hBHT9neCEFFBP3neq0S30zV9-1A";
const SHEET_NAME = "Form Responses 1";
const API_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_NAME}`;
// offline fallback image (base64 transparent)
const fallbackImage = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUAAAPAAAADwCAMAAAC7GKtPAAAAGFBMVEXMzMyWlpazs7PFxcW+vr6xsbG3t7fW1tawWyO7AAABYUlEQVR4nO3aMQ6DMAxFUaz//5tXxJAMxO3rZJbQ82YJH+UwDRRZIkSZIkSZIkSZIkSZIkSZIkSZLkJg/tj6yRzj/N7sgQh8Dk+MKx7h8ZvvVuqbBzDwPkVbcKfZ8OQ+irWjqYMXIXtcvY2EvNHauTmxvEba/cI5mxpL7HY8hc+PwS+2/tW6myXPc1/XeH7te38MnUXtd9r1pxNuv5xXcW7Wc1frvIyf3eLnd9lU7PtP3/E7O7QeeL8/1yze74d6xOeF5Q/HIkmSJEmSJEmSJEmSJEmSJEmSJEmS9E/wCUXSRgBksp/oAAAAASUVORK5CYII=";

// Global state management for filters
const allProducts = [];
const filterState = {
    stoneTypes: [],
    categories: [],
    colors: []
};


async function loadProducts() {
  const container = document.getElementById("products");
  container.innerHTML = "‚è≥ Loading...";

  try {
    const response = await fetch(API_URL);
    let data = await response.json();
    
    // Normalize column names by trimming spaces (Crucial for consistency)
    if (Array.isArray(data) && data.length > 0) {
        data = data.map(item => {
            const newItem = {};
            for (const key in item) {
                // Remove trailing/leading spaces from column names (keys)
                const newKey = key.trim(); 
                newItem[newKey] = item[key];
            }
            return newItem;
        });
    }

    if (!Array.isArray(data) || data.length === 0) {
      container.innerHTML = "<p>‚ö†Ô∏è No data found in the sheet.</p>";
      return;
    }

    // Store all data globally
    allProducts.splice(0, allProducts.length, ...data);
    
    // Generate Filters dynamically
    generateFilters(allProducts); 
    
    // Display all products initially
    displayProducts(allProducts);

  } catch (error) {
    console.error("Error loading data:", error);
    container.innerHTML = "<p>‚ùå Error loading products. Please check API URL or Sheet ID.</p>";
  }
}

// Function to convert Google Drive link
function getImgLink(item) {
    // Column name used is "UPLOAD SAMPLE IMAGE"
    let imgLink = item["UPLOAD SAMPLE IMAGE"] || ""; 
    if (imgLink.includes("drive.google.com")) {
        const match = imgLink.match(/[-\w]{25,}/);
        if (match) imgLink = `https://drive.google.com/uc?export=view&id=${match[0]}`;
    }
    return imgLink;
}


// Function to display products
function displayProducts(productsToDisplay) {
    const container = document.getElementById("products");
    const countElement = document.getElementById("product-count");
    
    if (productsToDisplay.length === 0) {
        container.innerHTML = `<p style="grid-column: 1 / -1; text-align: center;">No products match the selected filters.</p>`;
        countElement.textContent = 'Showing 0 products.';
        return;
    }
    
    let html = "";
    productsToDisplay.forEach(item => {
        const imgLink = getImgLink(item); 

        // Extract description, limiting to 100 characters for card view
        // Column name used is "DESCRIPTION"
        const rawDescription = item["DESCRIPTION"] || "Natural stone product."; 
        const shortDescription = rawDescription.substring(0, 100) + (rawDescription.length > 100 ? '...' : '');

        html += `
            <div class="product-card">
              <img src="${imgLink}" 
              class="product-img" onerror="this.src='${fallbackImage}'"/>
              
              <div class="product-info">
                  <p class="price">‚Çπ ${item["PRICE"] || "Price on Request"}</p>
                  
                  <h3>${item["STONE CATAGORY"] || "Unknown Stone"}</h3>
                  
                  <p class="description-short">${shortDescription}</p>
                  
                  <p>Type: ${item["STONE SUB CATAGORY"] || "N/A"}</p>
                  
                  <div class="contact-info">
                    <p><b>üìç ${item["ADDRESS"] || "Not Given"}</b></p>
                    <p>üìû ${item["CONTACT"] || ""}</p>
                  </div>
              </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
    countElement.textContent = `Showing ${productsToDisplay.length} products.`;
}


// ===== SMART FILTERING LOGIC =====

// Step 1: Generate filter options dynamically
function generateFilters(products) {
    // Collect unique values.
    const stoneTypes = [...new Set(products.map(p => p["STONE SUB CATAGORY"] ? p["STONE SUB CATAGORY"].trim() : null).filter(Boolean))].sort();
    const categories = [...new Set(products.map(p => p["STONE CATAGORY"] ? p["STONE CATAGORY"].trim() : null).filter(Boolean))].sort();
    // NOTE: Assuming you have a 'COLOR' column in your sheet
    const colors = [...new Set(products.map(p => p["COLOR"] ? p["COLOR"].trim() : null).filter(Boolean))].sort(); 

    // Helper to generate checkbox HTML
    const generateCheckboxes = (id, options, key) => {
        const container = document.getElementById(id);
        if (!container) return;
        
        if (options.length === 0) {
            container.innerHTML = `<p style="font-size: 12px; color: #aaa;">No options available.</p>`;
            return;
        }

        container.innerHTML = options.map(option => `
            <label>
                <input type="checkbox" data-filter-key="${key}" value="${option}" onchange="updateFilterState(this)">
                ${option}
            </label>
        `).join('');
    };

    // NOTE: The filter keys must match the (trimmed) column names from your sheet
    generateCheckboxes('stone-type-filters', stoneTypes, 'STONE SUB CATAGORY');
    generateCheckboxes('category-filters', categories, 'STONE CATAGORY');
    generateCheckboxes('color-filters', colors, 'COLOR');
}

// Step 2: Update the filter state when a checkbox is clicked
window.updateFilterState = function(checkbox) {
    const key = checkbox.getAttribute('data-filter-key');
    const value = checkbox.value;

    // Map sheet column names to internal state names
    const stateMap = {
        "STONE SUB CATAGORY": "stoneTypes",
        "STONE CATAGORY": "categories",
        "COLOR": "colors"
    };
    const stateKey = stateMap[key];

    if (checkbox.checked) {
        if (!filterState[stateKey].includes(value)) {
            filterState[stateKey].push(value);
        }
    } else {
        filterState[stateKey] = filterState[stateKey].filter(v => v !== value);
    }
}

// Step 3: Apply filters and update display
window.applyFilters = function() {
    let filteredList = [...allProducts];

    // Filter by Stone Type (STONE SUB CATAGORY)
    if (filterState.stoneTypes.length > 0) {
        filteredList = filteredList.filter(product => 
            product["STONE SUB CATAGORY"] && filterState.stoneTypes.includes(product["STONE SUB CATAGORY"].trim())
        );
    }
    
    // Filter by Category (STONE CATAGORY)
    if (filterState.categories.length > 0) {
        filteredList = filteredList.filter(product => 
            product["STONE CATAGORY"] && filterState.categories.includes(product["STONE CATAGORY"].trim())
        );
    }

    // Filter by Color (COLOR)
    if (filterState.colors.length > 0) {
        filteredList = filteredList.filter(product => 
            product["COLOR"] && filterState.colors.includes(product["COLOR"].trim())
        );
    }

    displayProducts(filteredList);
}

// Step 4: Clear all filters and show all products
window.clearFilters = function() {
    // Reset internal state
    filterState.stoneTypes = [];
    filterState.categories = [];
    filterState.colors = [];
    
    // Uncheck all checkboxes
    const checkboxes = document.querySelectorAll('#filter-panel input[type="checkbox"]');
    checkboxes.forEach(cb => {
        cb.checked = false;
    });

    // Display all products
    displayProducts(allProducts);
}


loadProducts();
</script>

</body>
</html>
