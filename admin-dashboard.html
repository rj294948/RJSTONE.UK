<!DOCTYPE html>
}


/* ================= UPDATE STATUS ================= */
window.updateStatus = async (userId,orderId,orderNumber)=>{
const status = document.getElementById(`status-${orderId}`).value;
const tracking = document.getElementById(`track-${orderId}`).value;
if(!status) return alert('Select status');


if(status==='shipped' && !tracking) return alert('Tracking required');


const update = {
orderStatus:status,
updatedAt:new Date().toISOString(),
[`statusTimeline.${status}`]:{at:new Date().toISOString()}
};


if(status==='shipped'){
update.trackingNumber = tracking;
update.shippingStatus='shipped';
update[`statusTimeline.${status}`].tracking=tracking;
}


await updateDoc(doc(db,'users',userId,'orders',orderId),update);


await addDoc(collection(db,'users',userId,'notifications'),{
orderId,orderNumber,type:'order',status,
title:getTitle(status),message:getMsg(status,tracking),
createdAt:new Date().toISOString(),read:false
});


alert('Updated Successfully');
loadOrders();
}


function getTitle(s){return{
payment_confirmed:'Payment Confirmed',processing:'Order Processing',ready_to_ship:'Ready To Ship',
shipped:'Order Shipped',out_for_delivery:'Out For Delivery',delivered:'Delivered',cancelled:'Order Cancelled'
}[s]}


function getMsg(s,t){return{
payment_confirmed:'Payment confirmed successfully',processing:'Your order is being processed',
ready_to_ship:'Packed and ready for shipping',
shipped:`Order shipped. Tracking: ${t}`,
out_for_delivery:'Courier is out for delivery',
delivered:'Order delivered successfully',
cancelled:'Order cancelled. Advance is non-refundable'
}[s]}


loadOrders();
</script>
</body>
</html>
