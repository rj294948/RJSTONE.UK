<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IRYA STONE ‚Äì Professional Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
/* --- Global & Typography --- */
body {
    font-family: 'Inter', sans-serif;
    background-color: #f4f7fa;
    margin: 0;
    padding: 25px;
    color: #333;
}
h2 {
    color: #1a202c;
    margin-bottom: 30px;
    font-weight: 800;
    font-size: 1.8em;
    border-bottom: 3px solid #e2e8f0;
    padding-bottom: 10px;
}
h3 {
    margin-top: 20px;
    margin-bottom: 15px;
    font-weight: 700;
    color: #4a5568;
    display: flex;
    align-items: center;
    gap: 8px;
    padding-left: 5px;
}
/* --- Tabs Navigation --- */
.tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 2px solid #e2e8f0;
}
.tab-button {
    padding: 10px 20px;
    cursor: pointer;
    background: transparent;
    border: none;
    font-weight: 600;
    color: #718096;
    border-bottom: 3px solid transparent;
    transition: all 0.3s;
}
.tab-button.active {
    color: #000;
    border-bottom: 3px solid #000;
    background-color: #fff;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

/* --- Search and Filter Bar --- */
.filter-bar {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    padding: 15px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.filter-bar input, .filter-bar select {
    flex-grow: 1;
    padding: 10px;
    border: 1px solid #cbd5e0;
    border-radius: 8px;
    font-size: 1em;
}

/* --- Order Card List View --- */
.order-summary {
    background: #ffffff;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 5px solid; /* For status color */
    transition: transform 0.2s;
}
.order-summary:hover {
    transform: translateY(-1px);
}
.order-main-info {
    flex-grow: 1;
    min-width: 300px;
}
.order-main-info b {
    font-size: 1.1em;
    margin-right: 10px;
}
.order-actions button {
    background: none;
    border: 1px solid #ddd;
    color: #4a5568;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    margin-left: 8px;
    transition: background-color 0.2s;
    font-size: 1em;
}
.order-actions button:hover {
    background: #f0f0f0;
    color: #000;
}

/* --- Detail Modal (Collapsed View) --- */
.detail-modal {
    background: #f7fafc;
    padding: 20px;
    border-radius: 12px;
    margin-top: 10px;
    display: none; /* Controlled by JS */
    border: 1px solid #e2e8f0;
}
.detail-modal.active {
    display: block;
}
/* Reusing previous report/action styles inside modal for consistency */
.report-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px 20px;
    font-size: 0.95em;
    padding-bottom: 15px;
    border-bottom: 1px dashed #ebf1f5;
    margin-bottom: 15px;
}
.detail-item {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
}
.addr {
    font-size: 0.9em;
    background: #fff;
    padding: 12px;
    border-radius: 10px;
    line-height: 1.4;
    margin-bottom: 15px;
    grid-column: 1 / span 2;
}
.product-item, .timeline-item {
    /* Styles for items inside the modal */
    padding: 5px 0;
    border-bottom: 1px dotted #e2e8f0;
}
.product-list, .timeline-section {
    padding: 15px 0;
    margin-bottom: 15px;
}
.action-box {
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}
.action-box .grid-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}
.action-title {
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 10px;
    border-bottom: 1px solid #eee;
    padding-bottom: 5px;
}
/* --- Badges & Colors --- */
.badge {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 5px;
    text-transform: capitalize;
}
/* Status Colors - Added out_for_delivery */
.paid, .delivered { border-left-color: #38a169 !important; background-color: #38a169; color: #fff; }
.advance { border-left-color: #ecc94b !important; background-color: #ecc94b; color: #333; }
.processing { border-left-color: #6f42c1 !important; background-color: #6f42c1; color: #fff; }
.ready { border-left-color: #0dcaf0 !important; background-color: #0dcaf0; color: #000; }
.shipped, .out_for_delivery { border-left-color: #f6ad55 !important; background-color: #f6ad55; color: #fff; } /* Orange for Shipped/O-F-D */
.cancelled { border-left-color: #dc3545 !important; background-color: #dc3545; color: #fff; }
.unpaid { border-left-color: #e53e3e !important; background-color: #e53e3e; color: #fff; }

/* --- Product Panel Styles --- */
#productsList {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}
.product-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    padding: 15px;
}
.product-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 10px;
}
.product-card h4 {
    margin: 5px 0;
    font-weight: 700;
    color: #2d3748;
}
.product-card p {
    margin: 3px 0;
    font-size: 0.9em;
    color: #718096;
}
.product-card .stock {
    font-weight: 700;
    color: #38a169;
}
</style>
</head>

<body>

<h2>üíé IRYA STONE Admin Dashboard</h2>

<div class="tabs">
    <button class="tab-button active" onclick="showPanel('ordersPanel')"><i class="fas fa-shopping-cart"></i> Orders Management</button>
    <button class="tab-button" onclick="showPanel('productsPanel')"><i class="fas fa-boxes"></i> Product Inventory</button>
</div>

<div id="ordersPanel" class="panel active">
    <h3>üîç Smart Order Search & Filter</h3>
    <div class="filter-bar">
        <input type="text" id="searchInput" placeholder="Search by Order #, Customer Name or Email..." onkeyup="filterOrders()">
        <select id="statusFilter" onchange="filterOrders()">
            <option value="all">Filter by Status (All)</option>
            <option value="processing">Processing</option>
            <option value="ready_to_ship">Ready to Ship</option>
            <option value="shipped">Shipped</option>
            <option value="out_for_delivery">Out for Delivery</option>
            <option value="delivered">Delivered</option>
            <option value="cancelled">Cancelled</option>
        </select>
    </div>
    
    <h3>Orders List</h3>
    <div id="ordersList">
        </div>
</div>

<div id="productsPanel" class="panel" style="display: none;">
    <h3>üì¶ Product Inventory List</h3>
    <div id="productsList">
        </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import {
  getFirestore, collectionGroup, getDocs,
  doc, getDoc, updateDoc, addDoc, collection,
  query, orderBy, limit, deleteDoc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// --- Configuration ---
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyDNW...", // Your API Key
  authDomain: "iryastone-uk.firebaseapp.com",
  projectId: "iryastone-uk"
};
const app = initializeApp(FIREBASE_CONFIG);
const db = getFirestore(app);

// Global DOM elements
const ordersList = document.getElementById("ordersList");
const productsList = document.getElementById("productsList");

// --- Utility Functions ---
const now = () => new Date().toISOString();
const formatCurrency = (amount) => `¬£${parseFloat(amount || 0).toFixed(2)}`;
const formatDate = (isoString) => isoString ? new Date(isoString).toLocaleString() : 'N/A';
const hoursDiff = (a, b) => (new Date(b) - new Date(a)) / 36e5;
let ALL_ORDERS = []; // Global array to hold all fetched orders for filtering

// Notification logic (same as previous)
async function notify(userId, title, msg) {
  const ref = collection(db, "users", userId, "notifications");
  await addDoc(ref, { title, message: msg, createdAt: now(), read: false });

  const q = query(ref, orderBy("createdAt", "desc"), limit(11));
  const snap = await getDocs(q);
  if (snap.size > 10) {
    snap.docs.slice(10).forEach(d => deleteDoc(d.ref));
  }
}

// --- Tab Switching Logic ---
window.showPanel = (panelId) => {
    document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
    document.getElementById(panelId).style.display = 'block';
    
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[onclick="showPanel('${panelId}')"]`).classList.add('active');

    // Load products only when products panel is shown
    if (panelId === 'productsPanel' && productsList.innerHTML === '') {
        loadProducts();
    }
    if (panelId === 'ordersPanel' && ordersList.innerHTML === '') {
         loadOrders();
    }
};


/* ---------------- LOAD ORDERS ---------------- */
async function loadOrders() {
  ordersList.innerHTML = '<p style="text-align:center; padding: 40px; color: #718096;"><i class="fas fa-spinner fa-spin"></i> Loading orders...</p>';
  
  const snap = await getDocs(collectionGroup(db, "orders"));
  ALL_ORDERS = [];

  for (const d of snap.docs) {
    const o = d.data();
    o._docId = d.id;
    o.createdAtDate = o.createdAt ? new Date(o.createdAt) : new Date(0);

    // Auto Cancel Logic
    if (o.status === "ready_to_ship" && o.remainingPayment > 0) {
      if (hoursDiff(o.readyToShipAt || o.updatedAt, now()) >= 1) {
        // Perform cancellation update (kept sync for immediate effect)
        await updateDoc(doc(db, "users", o.userId, "orders", o._docId), {
          status: "cancelled",
          cancelledAt: now(),
          statusHistory: [...(o.statusHistory || []), { status: "cancelled (auto)", at: now() }]
        });
        await notify(o.userId, "Order Cancelled", `Order ${o.orderNumber} automatically cancelled.`);
        continue;
      }
    }
    ALL_ORDERS.push(o);
  }

  // Sort by creation date (newest first)
  ALL_ORDERS.sort((a, b) => b.createdAtDate - a.createdAtDate);
  
  // Render based on current filters
  filterOrders();
}

/* ---------------- FILTER & SEARCH ---------------- */
window.filterOrders = () => {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const statusFilterValue = document.getElementById('statusFilter').value;
    
    let filteredOrders = ALL_ORDERS.filter(o => {
        // 1. Status Filter
        const statusMatch = statusFilterValue === 'all' || o.status === statusFilterValue;

        // 2. Search Term Filter
        const searchMatch = (
            o.orderNumber?.toLowerCase().includes(searchTerm) ||
            o.userName?.toLowerCase().includes(searchTerm) ||
            o.userEmail?.toLowerCase().includes(searchTerm)
        );

        return statusMatch && searchMatch;
    });

    if (filteredOrders.length === 0) {
        ordersList.innerHTML = '<p style="text-align:center; padding: 40px; color: #718096;"><i class="fas fa-info-circle"></i> No matching orders found.</p>';
        return;
    }
    
    // Clear the list and re-render
    ordersList.innerHTML = '';

    // Grouping logic (optional, but good for separation)
    const paid = filteredOrders.filter(o => o.paymentStatus === 'fully_paid');
    const pending = filteredOrders.filter(o => o.paymentStatus !== 'fully_paid');

    // Inject Sections
    ordersList.innerHTML += `<h3>‚úÖ Fully Paid Orders (${paid.length})</h3>`;
    paid.forEach(o => renderOrderSummary(o, ordersList));
    
    ordersList.innerHTML += `<h3>‚ö†Ô∏è Pending / Advance Orders (${pending.length})</h3>`;
    pending.forEach(o => renderOrderSummary(o, ordersList));
};

/* ---------------- RENDER ORDER SUMMARY ---------------- */
function renderOrderSummary(o, container) {
    const statusClass = o.status?.replaceAll("_", "") || "processing";
    const paymentClass = o.paymentStatus === "fully_paid" ? "paid" : (o.submittedAmount > 0 ? "advance" : "unpaid");
    const remainingStyle = o.remainingPayment > 0 ? 'color: #dc3545; font-weight: 700;' : 'color: #38a169;';

    const orderSummaryHTML = `
        <div class="order-summary ${statusClass}" style="border-left-color: var(--${paymentClass}-color, ${paymentClass === 'paid' ? '#38a169' : '#ecc94b'});">
            <div class="order-main-info">
                <b>#${o.orderNumber}</b> 
                <span class="badge ${statusClass}">${o.status.replaceAll("_", " ")}</span>
                <span class="badge ${paymentClass}">${paymentClass === 'paid' ? 'Fully Paid' : (o.submittedAmount > 0 ? 'Advance' : 'Unpaid')}</span>
                <div style="font-size: 0.9em; margin-top: 5px; color: #555;">
                    ${o.userName} (${formatCurrency(o.total)} | <span style="${remainingStyle}">Due: ${formatCurrency(o.remainingPayment)}</span>)
                </div>
            </div>
            
            <div class="order-actions">
                <button title="View Full Report" onclick="toggleDetails('${o._docId}')">
                    <i class="fas fa-eye"></i> View
                </button>
                <button title="Update Payment" onclick="toggleDetails('${o._docId}', 'payment')">
                    <i class="fas fa-money-bill-wave"></i> Payment
                </button>
                <button title="Update Status" onclick="toggleDetails('${o._docId}', 'status')">
                    <i class="fas fa-truck"></i> Status
                </button>
            </div>
        </div>
        
        <div id="details-${o._docId}" class="detail-modal">
            ${renderFullDetails(o)}
        </div>
    `;
    container.innerHTML += orderSummaryHTML;
}

/* ---------------- RENDER FULL DETAILS (FOR MODAL) ---------------- */
function renderFullDetails(o) {
    // This is run once during initial render
    const remainingStyle = o.remainingPayment > 0 ? 'color: #e53e3e;' : 'color: #38a169;';
    const addr = o.shippingAddress || {};
    
    // Timeline History
    const timelineHTML = (o.statusHistory || []).map(h => {
        return `<div class="timeline-item"><i class="fas fa-check-circle"></i> Status: ${h.status.replaceAll("_", " ")} ‚Äì ${formatDate(h.at)}</div>`;
    }).join('');

    // Products (NOTE: Product images/titles are handled async in loadOrders, here we assume it's basic order item data)
    let productsHTML = (o.items || []).map(it => {
        return `
        <div class="product-item">
          <div class="flex" style="gap:10px; align-items:flex-start;">
            <i class="fas fa-box-open" style="font-size: 1.5em; color: #6f42c1;"></i> 
            <div>
              <b>${it.name || 'Unknown Product'}</b>
              <span>Qty ${it.quantity} | Total ${formatCurrency(it.totalPrice)}</span>
            </div>
          </div>
        </div>`;
    }).join('');

    return `
    <h4 style="margin-top:0;">Order #${o.orderNumber} Details</h4>
    
    <div class="report-details">
        <div class="detail-item"><span class="detail-label">Customer Name:</span><span class="detail-value">${o.userName || 'N/A'}</span></div>
        <div class="detail-item"><span class="detail-label">Order Date:</span><span class="detail-value">${formatDate(o.createdAt)}</span></div>
        <div class="detail-item"><span class="detail-label">Total Amount:</span><span class="detail-value">${formatCurrency(o.total)}</span></div>
        <div class="detail-item"><span class="detail-label">Amount Paid:</span><span class="detail-value">${formatCurrency(o.submittedAmount)}</span></div>
        <div class="detail-item"><span class="detail-label">Remaining Due:</span><span class="detail-value" style="${remainingStyle}">${formatCurrency(o.remainingPayment)}</span></div>
        <div class="detail-item"><span class="detail-label">Tracking Number:</span><span class="detail-value">${o.trackingNumber || 'N/A'}</span></div>

        <div class="addr">
            <b><i class="fas fa-map-marker-alt"></i> Shipping Address</b><br>
            ${addr.fullName || 'N/A'}, ${addr.address1 || 'N/A'}<br>
            ${addr.city || 'N/A'}, ${addr.state || 'N/A'} - <b>${addr.postalCode || 'N/A'}</b>
        </div>
    </div>
    
    <div class="product-list">
        <div class="action-title"><i class="fas fa-box"></i> Ordered Products:</div>
        ${productsHTML}
    </div>

    <div class="timeline-section">
        <div class="action-title"><i class="fas fa-history"></i> Status History:</div>
        ${timelineHTML || '<div class="timeline-item">No status history available.</div>'}
    </div>


    <div id="paymentBox-${o._docId}" class="action-box" style="display:none;">
        <div class="action-title">üí≥ Update Payment Status (Current Paid: ${formatCurrency(o.submittedAmount)})</div>
        <div class="grid-2">
            <select id="pay-${o._docId}" style="grid-column: 1 / span 2;">
                <option value="">Select Payment Status</option>
                <option value="advance">Advance Payment Confirmed</option>
                <option value="full">Full Payment Confirmed</option>
            </select>
            <input id="amt-${o._docId}" type="number" placeholder="New Paid Amount" value="">
            <input id="ref-${o._docId}" placeholder="Transaction / Reference No" value="${o.transactionReference || ''}">
        </div>
        <button onclick="confirmPayment('${o.userId}','${o._docId}','${o.orderNumber}',${o.total})">
            <i class="fas fa-check"></i> CONFIRM PAYMENT
        </button>
    </div>

    <div id="statusBox-${o._docId}" class="action-box" style="display:none;">
        <div class="action-title">üöö Update Order Status (Current: ${o.status.replaceAll("_", " ")})</div>
        <div class="grid-2">
            <select id="st-${o._docId}">
                <option value="">Select New Order Status</option>
                <option value="processing">Processing</option>
                <option value="ready_to_ship">Ready to Ship</option>
                <option value="shipped">Shipped</option>
                <option value="out_for_delivery">Out for Delivery</option>
                <option value="delivered">Delivered</option>
                <option value="cancelled">Cancelled</option>
            </select>
            <input id="trk-${o._docId}" placeholder="Tracking Number (If Shipped)" value="${o.trackingNumber || ''}">
        </div>
        <button onclick="updateStatus('${o.userId}','${o._docId}','${o.orderNumber}')">
            <i class="fas fa-paper-plane"></i> UPDATE STATUS
        </button>
    </div>`;
}

/* ---------------- TOGGLE DETAILS / ACTION BOXES ---------------- */
window.toggleDetails = (orderId, actionType = 'view') => {
    const detailModal = document.getElementById(`details-${orderId}`);
    const paymentBox = document.getElementById(`paymentBox-${orderId}`);
    const statusBox = document.getElementById(`statusBox-${orderId}`);
    
    // Hide all action boxes first
    paymentBox.style.display = 'none';
    statusBox.style.display = 'none';

    // Toggle the main detail modal
    if (detailModal.classList.contains('active') && actionType === 'view') {
        detailModal.classList.remove('active');
        return;
    }
    
    detailModal.classList.add('active');

    // Show the requested action box
    if (actionType === 'payment') {
        paymentBox.style.display = 'block';
    } else if (actionType === 'status') {
        statusBox.style.display = 'block';
    }
};

/* ---------------- PAYMENT ---------------- */
window.confirmPayment = async (userId, id, ord, total) => {
    // ... (Your previous confirmPayment logic, but using new element IDs)
    const type = document.getElementById(`pay-${id}`).value;
    const amt = Number(document.getElementById(`amt-${id}`).value);
    const ref = document.getElementById(`ref-${id}`).value;
    
    if (!type || !amt || amt <= 0) return alert("Payment info missing or amount is invalid.");

    try {
        const docRef = doc(db, "users", userId, "orders", id);
        const snap = await getDoc(docRef);
        const o = snap.data();
        
        const currentSubmitted = parseFloat(o.submittedAmount || 0);
        const newTotalSubmitted = currentSubmitted + amt;

        let newPaymentStatus = "advance_paid";
        let newRemaining = Math.max(total - newTotalSubmitted, 0);

        if (newTotalSubmitted >= total) {
            newRemaining = 0;
            newPaymentStatus = "fully_paid";
        }

        await updateDoc(docRef, {
            paymentStatus: newPaymentStatus,
            submittedAmount: newTotalSubmitted,
            remainingPayment: newRemaining,
            transactionReference: ref || o.transactionReference || "Multiple Transactions",
            paymentSubmittedAt: now(),
            updatedAt: now()
        });

        await notify(userId, "Payment Confirmed",
            newPaymentStatus === "fully_paid"
            ? `Full payment confirmed for ${ord}. Total Paid: ${formatCurrency(newTotalSubmitted)}.`
            : `Payment of ${formatCurrency(amt)} received for ${ord}. Remaining: ${formatCurrency(newRemaining)}.`);
        
        alert(`Payment confirmed for Order #${ord}.`);
        loadOrders();
        toggleDetails(id, 'view'); // Close details after update
    } catch (error) {
        console.error("Payment update failed:", error);
        alert("Error confirming payment. Check console.");
    }
};

/* ---------------- STATUS ---------------- */
window.updateStatus = async (userId, id, ord) => {
    // ... (Your previous updateStatus logic, including 'out_for_delivery')
    const stEl = document.getElementById(`st-${id}`);
    const trk = document.getElementById(`trk-${id}`).value;
    const st = stEl.value;

    if (!st) return alert("Please select a new status to update the order.");

    try {
        const ref = doc(db, "users", userId, "orders", id);
        const snap = await getDoc(ref);
        const o = snap.data();

        const hist = [...(o.statusHistory || []), { status: st, at: now() }];
        stEl.value = ""; 

        const upd = {
            status: st,
            trackingNumber: trk || o.trackingNumber || "",
            updatedAt: now(),
            statusHistory: hist
        };

        if (st === "ready_to_ship") {
            upd.readyToShipAt = now();
            // Notification logic for pending payment on ready_to_ship...
        }
        
        // Added 'out_for_delivery'
        if (st === "shipped" || st === "out_for_delivery") {
            if (!upd.trackingNumber) {
                alert("Tracking Number is required for Shipped or Out for Delivery status.");
                return;
            }
            if(st === "out_for_delivery") {
                await notify(userId, "Out for Delivery", `Order ${ord} is out for delivery today!`);
            }
        }

        if (st === "delivered") {
            upd.deliveredAt = now();
            upd.remainingPayment = 0; 
        }

        await updateDoc(ref, upd);
        await notify(userId, "Order Update", `Your Order #${ord} is now ${st.replaceAll("_", " ")}`);

        alert(`Status updated for Order #${ord} to ${st.replaceAll("_", " ")}.`);
        loadOrders();
        toggleDetails(id, 'view'); // Close details after update
    } catch (error) {
        console.error("Status update failed:", error);
        alert("Error updating status. Check console.");
    }
};

/* ---------------- LOAD PRODUCTS ---------------- */
async function loadProducts() {
    productsList.innerHTML = '<p style="text-align:center; padding: 40px; color: #718096;"><i class="fas fa-spinner fa-spin"></i> Loading product inventory...</p>';
    
    try {
        const snap = await getDocs(collection(db, "products"));
        productsList.innerHTML = '';
        
        snap.forEach(d => {
            const p = d.data();
            const stockColor = p.stock > 10 ? '#38a169' : (p.stock > 0 ? '#f6ad55' : '#e53e3e');

            productsList.innerHTML += `
                <div class="product-card">
                    <img src="${p.images?.[0] || 'https://via.placeholder.com/300x180/e2e8f0?text=No+Image'}" alt="${p.title}">
                    <h4>${p.title || 'Product Title Missing'}</h4>
                    <p>Price: <b>${formatCurrency(p.price)}</b></p>
                    <p>Category: ${p.category || 'N/A'}</p>
                    <p>Stock: <span class="stock" style="color: ${stockColor};">${p.stock || 0} units</span></p>
                    <button style="margin-top:10px; padding: 8px; background:#4299e1;" onclick="alert('Implement product edit logic for: ${p.title}')">
                        <i class="fas fa-edit"></i> Edit Product
                    </button>
                </div>
            `;
        });
        
    } catch (error) {
        console.error("Error loading products:", error);
        productsList.innerHTML = '<p style="color: #e53e3e; text-align:center;">Failed to load product list.</p>';
    }
}

// Initial load
loadOrders(); // Load orders by default
</script>
</body>
</html>
